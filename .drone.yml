kind: pipeline
type: kubernetes
name: Deploy Afstemning
steps:
  - name: Deploy Main Container
    image: ubuntu
    settings:
      kube_config:
        from_secret: kube_config
      kubernetes_cert:
        from_secret: k8s_cert
      kubernetes_token:
        from_secret: k8s_token
    commands:
      - apt update && apt install -y curl gnupg2 
      - curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
      - touch /etc/apt/sources.list.d/kubernetes.list 
      - echo "deb http://apt.kubernetes.io/ kubernetes-xenial main" | tee -a /etc/apt/sources.list.d/kubernetes.list
      - apt-get update
      - apt-get install -y kubectl
      - mkdir .kube && echo $${kube_config} > .kube/config
      - kubectl get nodes